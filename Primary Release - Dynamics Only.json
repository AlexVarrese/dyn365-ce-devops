{
    "source": 2,
    "id": 3,
    "revision": 3,
    "name": "Primary Release - Dynamics Only",
    "description": null,
    "createdBy": {
        "id": "6582fd44-c7b5-6af6-8054-e8e93761fc9c",
        "displayName": "Marc Schweigert",
        "uniqueName": "admin@dkdtdevops.onmicrosoft.com",
        "url": "https://app.vssps.visualstudio.com/A23c752fb-0c7e-40ce-b5fc-276e6094b415/_apis/Identities/6582fd44-c7b5-6af6-8054-e8e93761fc9c",
        "imageUrl": "https://dkdtdevops.visualstudio.com/_api/_common/identityImage?id=6582fd44-c7b5-6af6-8054-e8e93761fc9c"
    },
    "createdOn": "2017-10-06T15:54:08.257Z",
    "modifiedBy": {
        "id": "6582fd44-c7b5-6af6-8054-e8e93761fc9c",
        "displayName": "Marc Schweigert",
        "uniqueName": "admin@dkdtdevops.onmicrosoft.com",
        "url": "https://app.vssps.visualstudio.com/A23c752fb-0c7e-40ce-b5fc-276e6094b415/_apis/Identities/6582fd44-c7b5-6af6-8054-e8e93761fc9c",
        "imageUrl": "https://dkdtdevops.visualstudio.com/_api/_common/identityImage?id=6582fd44-c7b5-6af6-8054-e8e93761fc9c"
    },
    "modifiedOn": "2017-10-06T15:55:40.227Z",
    "path": "\\",
    "variables": {
        "dynBaseLanguage": {
            "value": "1033"
        },
        "dynConnectionString": {
            "value": "AuthType=Office365;Username=$(dynUserName);Url=$(dynUrl);Password=$(dynPassword)"
        },
        "dynInstanceType": {
            "value": "Sandbox"
        },
        "dynMgmtApiUrl": {
            "value": "https://admin.services.crm.dynamics.com"
        },
        "dynUrl": {
            "value": "https://$(dynDomain).crm.dynamics.com"
        },
        "dynUserName": {
            "value": "$(dynUser)@$(dynTenant)"
        }
    },
    "variableGroups": [],
    "environments": [
        {
            "id": 3,
            "name": "myenvironment",
            "rank": 1,
            "owner": {
                "id": "6582fd44-c7b5-6af6-8054-e8e93761fc9c",
                "displayName": "Marc Schweigert",
                "uniqueName": "admin@dkdtdevops.onmicrosoft.com",
                "url": "https://app.vssps.visualstudio.com/A23c752fb-0c7e-40ce-b5fc-276e6094b415/_apis/Identities/6582fd44-c7b5-6af6-8054-e8e93761fc9c",
                "imageUrl": "https://dkdtdevops.visualstudio.com/_api/_common/identityImage?id=6582fd44-c7b5-6af6-8054-e8e93761fc9c"
            },
            "variables": {
                "dynDomain": {
                    "value": "yourdyndomain"
                },
                "dynFriendlyName": {
                    "value": "your friendly name"
                },
                "dynPassword": {
                    "value": null,
                    "isSecret": true
                },
                "dynSecureConfig": {
                    "value": "\"[['0d392320-e6b5-e611-80f3-c4346bac2908','$(NamespaceConnectionString);EntityPath=crmqueue']]\""
                },
                "dynServiceVersionId": {
                    "value": "31cafafe-c6b1-4c0a-bb53-73927841bc5c"
                },
                "dynTenant": {
                    "value": "yourtenant.onmicrosoft.com"
                },
                "dynUser": {
                    "value": "youruser"
                }
            },
            "preDeployApprovals": {
                "approvals": [
                    {
                        "rank": 1,
                        "isAutomated": true,
                        "isNotificationOn": false,
                        "id": 7
                    }
                ]
            },
            "deployStep": {
                "tasks": [],
                "id": 8
            },
            "postDeployApprovals": {
                "approvals": [
                    {
                        "rank": 1,
                        "isAutomated": true,
                        "isNotificationOn": false,
                        "id": 9
                    }
                ]
            },
            "deployPhases": [
                {
                    "deploymentInput": {
                        "parallelExecution": {
                            "parallelExecutionType": "none"
                        },
                        "skipArtifactsDownload": false,
                        "queueId": 4,
                        "demands": [],
                        "enableAccessToken": false,
                        "timeoutInMinutes": 0,
                        "jobCancelTimeoutInMinutes": 1,
                        "condition": "succeeded()",
                        "overrideInputs": {}
                    },
                    "rank": 1,
                    "phaseType": 1,
                    "name": "Agent phase",
                    "workflowTasks": [
                        {
                            "taskId": "e213ff0f-5d5c-4791-802d-52ea3e7be1f1",
                            "version": "1.*",
                            "name": "Install-Module Microsoft.Xrm.OnlineManagementAPI copy",
                            "refName": "ClonedPowerShell11",
                            "enabled": true,
                            "alwaysRun": false,
                            "continueOnError": false,
                            "timeoutInMinutes": 0,
                            "definitionType": "task",
                            "overrideInputs": {},
                            "condition": "succeeded()",
                            "inputs": {
                                "scriptType": "inlineScript",
                                "scriptName": "",
                                "arguments": "",
                                "workingFolder": "",
                                "inlineScript": "Write-Host \"Installing Microsoft.Xrm.OnlineManagementAPI...\"\n\nInstall-Module Microsoft.Xrm.OnlineManagementAPI -SkipPublisherCheck -Force -Scope CurrentUser",
                                "failOnStandardError": "true"
                            }
                        },
                        {
                            "taskId": "e213ff0f-5d5c-4791-802d-52ea3e7be1f1",
                            "version": "1.*",
                            "name": "Download Reset Dynamics 365 Instance Script copy",
                            "refName": "ClonedPowerShell22",
                            "enabled": true,
                            "alwaysRun": false,
                            "continueOnError": false,
                            "timeoutInMinutes": 0,
                            "definitionType": "task",
                            "overrideInputs": {},
                            "condition": "succeeded()",
                            "inputs": {
                                "scriptType": "inlineScript",
                                "scriptName": "",
                                "arguments": "",
                                "workingFolder": "$(System.DefaultWorkingDirectory)/Primary Build/drop",
                                "inlineScript": "# I've asked for tasks to be added to the following VSTS extension:\n# https://github.com/WaelHamze/xrm-ci-framework/issues/46 (vote it up)\n# Until then, this approach will get the job done.\n\n$url = \"https://raw.githubusercontent.com/devkeydet/dyn365-ce-mgmt-api-devops-scripts/1.1/ResetInstanceByDomainName.ps1\"\n$output = \"ResetInstanceByDomainName.ps1\"\nInvoke-WebRequest -Uri $url -OutFile $output",
                                "failOnStandardError": "true"
                            }
                        },
                        {
                            "taskId": "e213ff0f-5d5c-4791-802d-52ea3e7be1f1",
                            "version": "1.*",
                            "name": "Reset Dynamics 365 Instance copy",
                            "refName": "ClonedPowerShell13",
                            "enabled": true,
                            "alwaysRun": false,
                            "continueOnError": false,
                            "timeoutInMinutes": 0,
                            "definitionType": "task",
                            "overrideInputs": {},
                            "condition": "succeeded()",
                            "inputs": {
                                "scriptType": "filePath",
                                "scriptName": "$(System.DefaultWorkingDirectory)/Primary Build/drop/ResetInstanceByDomainName.ps1",
                                "arguments": "-ApiUrl \"$(dynMgmtApiUrl)\" -UserName \"$(dynUserName)\" -Password \"$(dynPassword)\" -BaseLanguage $(dynBaseLanguage) -DomainName \"$(dynDomain)\" -FriendlyName \"$(dynFriendlyName)\" -InitialUserEmail \"$(dynUserName)\" -ServiceVersionId \"$(dynServiceVersionId)\" -InstanceType \"$(dynInstanceType)\"",
                                "workingFolder": "",
                                "inlineScript": "# You can write your powershell scripts inline here. \n# You can also pass predefined and custom variables to this scripts using arguments\n\n Write-Host \"Hello World\"",
                                "failOnStandardError": "true"
                            }
                        },
                        {
                            "taskId": "f41ba110-0b12-45bc-94c9-67655cb59323",
                            "version": "8.*",
                            "name": "Deploy Dynamics 365 Package and Data using Package Deployer",
                            "refName": "MSCRMPackageDeployer1",
                            "enabled": true,
                            "alwaysRun": false,
                            "continueOnError": false,
                            "timeoutInMinutes": 0,
                            "definitionType": "task",
                            "overrideInputs": {},
                            "condition": "succeeded()",
                            "inputs": {
                                "crmConnectionString": "$(dynConnectionString)",
                                "packageName": "DeploymentPackage.dll",
                                "packageDirectory": "$(System.DefaultWorkingDirectory)/Primary Build/drop/DeploymentPackage/bin/Release"
                            }
                        },
                        {
                            "taskId": "e213ff0f-5d5c-4791-802d-52ea3e7be1f1",
                            "version": "1.*",
                            "name": "Download UpdateSecureConfiguration.exe Utility",
                            "refName": "PowerShell1",
                            "enabled": true,
                            "alwaysRun": false,
                            "continueOnError": false,
                            "timeoutInMinutes": 0,
                            "definitionType": "task",
                            "overrideInputs": {},
                            "condition": "succeeded()",
                            "inputs": {
                                "scriptType": "inlineScript",
                                "scriptName": "",
                                "arguments": "",
                                "workingFolder": "$(System.DefaultWorkingDirectory)/Primary Build/drop",
                                "inlineScript": "# You can write your powershell scripts inline here. \n# You can also pass predefined and custom variables to this scripts using arguments\n\nWrite-Host \"Downloading UpdateSecureConfiguration.exe\"\n\n$url = \"https://github.com/devkeydet/UpdateSecureConfiguration/files/1296117/UpdateSecureConfiguration_1.0.0.0.zip\"\n$output = \"UpdateSecureConfiguration_1.0.0.0.zip\"\nInvoke-WebRequest -Uri $url -OutFile $output\n",
                                "failOnStandardError": "true"
                            }
                        },
                        {
                            "taskId": "5e1e3830-fbfb-11e5-aab1-090c92bc4988",
                            "version": "1.*",
                            "name": "Extract UpdateSecureConfiguration_1.0.0.0.zip",
                            "refName": "ExtractFiles2",
                            "enabled": true,
                            "alwaysRun": false,
                            "continueOnError": false,
                            "timeoutInMinutes": 0,
                            "definitionType": "task",
                            "overrideInputs": {},
                            "condition": "succeeded()",
                            "inputs": {
                                "archiveFilePatterns": "$(System.DefaultWorkingDirectory)/Primary Build/drop/UpdateSecureConfiguration_1.0.0.0.zip",
                                "destinationFolder": "$(System.DefaultWorkingDirectory)/Primary Build/drop",
                                "cleanDestinationFolder": "false"
                            }
                        },
                        {
                            "taskId": "bfc8bf76-e7ac-4a8c-9a55-a944a9f632fd",
                            "version": "1.*",
                            "name": "Run UpdateSecureConfiguration.exe",
                            "refName": "BatchScript1",
                            "enabled": true,
                            "alwaysRun": false,
                            "continueOnError": false,
                            "timeoutInMinutes": 0,
                            "definitionType": "task",
                            "overrideInputs": {},
                            "condition": "succeeded()",
                            "inputs": {
                                "filename": "$(System.DefaultWorkingDirectory)/Primary Build/drop/UpdateSecureConfiguration.exe",
                                "arguments": "\"$(dynConnectionString)\" \"$(dynSecureConfig)\"",
                                "modifyEnvironment": "False",
                                "workingFolder": "$(System.DefaultWorkingDirectory)/Primary CI Build/drop",
                                "failOnStandardError": "false"
                            }
                        }
                    ]
                }
            ],
            "environmentOptions": {
                "emailNotificationType": "OnlyOnFailure",
                "emailRecipients": "release.environment.owner;release.creator",
                "skipArtifactsDownload": false,
                "timeoutInMinutes": 0,
                "enableAccessToken": false,
                "publishDeploymentStatus": true
            },
            "demands": [],
            "conditions": [],
            "executionPolicy": {
                "concurrencyCount": 0,
                "queueDepthCount": 0
            },
            "schedules": [],
            "retentionPolicy": {
                "daysToKeep": 30,
                "releasesToKeep": 3,
                "retainBuild": true
            },
            "processParameters": {},
            "properties": {}
        }
    ],
    "artifacts": [
        {
            "sourceId": "7895651c-7f1a-466c-aa8f-0352510e6c2c:2",
            "type": "Build",
            "alias": "Primary Build",
            "definitionReference": {
                "artifactSourceDefinitionUrl": {
                    "id": "https://dkdtdevops.visualstudio.com/_permalink/_build/index?collectionId=d9f3dc16-657a-4720-bce2-9a7f421ec538&projectId=7895651c-7f1a-466c-aa8f-0352510e6c2c&definitionId=2",
                    "name": ""
                },
                "defaultVersionBranch": {
                    "id": "",
                    "name": ""
                },
                "defaultVersionSpecific": {
                    "id": "",
                    "name": ""
                },
                "defaultVersionTags": {
                    "id": "",
                    "name": ""
                },
                "defaultVersionType": {
                    "id": "latestType",
                    "name": "Latest"
                },
                "definition": {
                    "id": "2",
                    "name": "Primary Build"
                },
                "project": {
                    "id": "7895651c-7f1a-466c-aa8f-0352510e6c2c",
                    "name": "MyFirstProject"
                }
            },
            "isPrimary": true
        }
    ],
    "triggers": [],
    "releaseNameFormat": "Primary Release - Dynamics Only $(Build.BuildNumber)-$(Date:hhmmss)",
    "url": "https://dkdtdevops.vsrm.visualstudio.com/7895651c-7f1a-466c-aa8f-0352510e6c2c/_apis/Release/definitions/3",
    "_links": {
        "self": {
            "href": "https://dkdtdevops.vsrm.visualstudio.com/7895651c-7f1a-466c-aa8f-0352510e6c2c/_apis/Release/definitions/3"
        },
        "web": {
            "href": "https://dkdtdevops.visualstudio.com/7895651c-7f1a-466c-aa8f-0352510e6c2c/_release?definitionId=3"
        }
    },
    "tags": [],
    "properties": {}
}